# ローン計算機

このプロジェクトは、住宅ローンなどの返済計画を計算するJavaScriptライブラリです。

## 機能

- 月額返済額の計算
- 年ごとの残高テーブルの表示
- 総支払額と総利息額の計算
- **住宅ローン控除の計算**（13年間、年末残高または4500万円の少ない方の0.7%）
- **13年目終了時点での中間集計表示**（控除期間終了時の詳細な分析）

## 使い方

### 基本的な使い方

```javascript
const { displayLoanCalculation } = require('./loanCalculator');

// ローン金額3000万円、年利1.5%、35年で計算
displayLoanCalculation(3000000, 1.5, 35);

// 住宅ローン控除ありで計算
displayLoanCalculation(3000000, 1.5, 35, true);
```

### 個別の関数を使用する場合

```javascript
const { calculateMonthlyPayment, calculateYearlyBalance } = require('./loanCalculator');

// 月額返済額のみ計算
const monthlyPayment = calculateMonthlyPayment(3000000, 1.5, 35);
console.log(`月額返済額: ${Math.round(monthlyPayment).toLocaleString()}円`);

// 年ごとの詳細データを取得
const yearlyData = calculateYearlyBalance(3000000, monthlyPayment, 1.5, 35);
console.log(yearlyData);
```

### コマンドラインから実行

```bash
# サンプル計算を実行
npm start

# インタラクティブモード（対話形式で入力）
npm run interactive

# 様々な例を確認
npm run examples

# 基本のサンプル実行
npm run loan
```

## 関数リファレンス

### `calculateMonthlyPayment(loanAmount, annualRate, years)`

月額返済額を計算します。

- `loanAmount`: ローン金額（円）
- `annualRate`: 年利率（%）
- `years`: 借入期間（年）
- 戻り値: 月額返済額（円）

### `calculateYearlyBalance(loanAmount, monthlyPayment, annualRate, years)`

年ごとの残高情報を計算します。

- `loanAmount`: ローン金額（円）
- `monthlyPayment`: 月額返済額（円）
- `annualRate`: 年利率（%）
- `years`: 借入期間（年）
- 戻り値: 年ごとの返済情報の配列

### `displayLoanCalculation(loanAmount, annualRate, years, hasDeduction)`

ローン計算結果を見やすい表形式で表示します。

- `loanAmount`: ローン金額（円）
- `annualRate`: 年利率（%）
- `years`: 借入期間（年）
- `hasDeduction`: 住宅ローン控除を適用するか（省略可、デフォルトはfalse）

### `calculateLoanDeduction(remainingBalance, year, hasDeduction)`

住宅ローン控除額を計算します。

- `remainingBalance`: 年末時点の借入残高（円）
- `year`: 何年目か（1から開始）
- `hasDeduction`: 住宅ローン控除を適用するか
- 戻り値: 控除額（円）

## 出力例

### 通常のローン計算

```
================================================================================
                            ローン計算結果
================================================================================
ローン金額: 30,000,000円
年利率: 1.5%
借入期間: 35年
月額返済額: 91,855円

年ごとの返済計画:
--------------------------------------------------------------------------------
年 |   年間返済額   |   元本返済額   |   利息支払額   |     残債額     
--------------------------------------------------------------------------------
 1 |    1,102,260 |      652,136 |      450,124 |   29,347,864
 2 |    1,102,260 |      661,916 |      440,344 |   28,685,948
 3 |    1,102,260 |      671,844 |      430,416 |   28,014,104
...
```

### 住宅ローン控除適用時

```
================================================================================
                            ローン計算結果
================================================================================
ローン金額: 40,000,000円
年利率: 1.3%
借入期間: 35年
月額返済額: 118,593円
住宅ローン控除: 適用あり（13年間、年末残高または4500万円の少ない方の0.7%）

年ごとの返済計画:
------------------------------------------------------------------------------------------------
年 |   年間返済額   |   元本返済額   |   利息支払額   |     残債額     |   住宅ローン控除
------------------------------------------------------------------------------------------------
 1 |    1,423,114 |      908,515 |      514,599 |   39,091,485 |        273,640
 2 |    1,423,114 |      920,396 |      502,718 |   38,171,089 |        267,198
...
13 |    1,423,114 |    1,061,807 |      361,308 |   27,216,635 |        190,516
14 |    1,423,114 |    1,075,693 |      347,422 |   26,140,942 |              0
...

【住宅ローン控除期間終了時点（13年目終了時）の集計】
13年間の総支払額: 18,500,488円
13年間の総利息額: 5,717,123円
13年間の総控除額: 3,029,885円
13年間の実質負担額: 15,470,604円
13年目終了時の残債額: 27,216,635円

【14年目以降（控除終了後）の見通し】
14年目以降の総支払額: 31,308,519円
14年目以降の総利息額: 4,091,884円
残り返済期間: 22年

総支払額: 49,809,007円
総利息額: 9,809,007円
総控除額: 3,029,885円
実質負担額: 46,779,122円
```

## 計算方法

このライブラリは元利均等返済方式を使用しています。月額返済額は以下の式で計算されます：

```
月額返済額 = 元本 × (月利率 × (1 + 月利率)^返済回数) / ((1 + 月利率)^返済回数 - 1)
```

金利が0%の場合は、元本を返済回数で割った金額が月額返済額となります。
